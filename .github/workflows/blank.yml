name: Android Build CI

# 触发条件：main/master分支push/PR，也可手动触发
on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch: # 手动触发

# 构建环境
jobs:
  build:
    runs-on: ubuntu-latest # 轻量Linux环境，适配Android构建

    steps:
      # 1. 拉取GitHub项目代码
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 拉取完整历史，避免Gradle依赖问题

      # 2. 配置Java环境（Android构建需JDK11）
      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: gradle # 缓存Gradle，加速后续构建

      # 3. 赋予Gradle执行权限
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      # 4. 构建Release版APK（适配你的build.gradle配置）
      - name: Build Release APK
        run: ./gradlew assembleRelease --no-daemon # --no-daemon避免守护进程内存泄漏

      # 5. 保存构建产物（APK），可在GitHub Actions页面下载
      # 替换原Upload Release APK步骤
      - name: Upload Release APK
        uses: actions/upload-artifact@v4
        with:
          name: app-release-unsigned-apk
          path: |
           ./*.apk          # 匹配项目根目录下所有APK
           !./app/**/*.apk  # 排除原build目录下的APK，仅保留根目录副本
          retention-days: 7
